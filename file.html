<div class="CodeRay">
  <div class="code"><pre>require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">bundler/setup</span><span style="color:#710">'</span></span>
<span style="color:#036;font-weight:bold">Bundler</span>.require(<span style="color:#A60">:default</span>)

require_relative <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">models/post</span><span style="color:#710">'</span></span>
require_relative <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">models/user</span><span style="color:#710">'</span></span>
require_relative <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">models/comment</span><span style="color:#710">'</span></span>
require_relative <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">models/like</span><span style="color:#710">'</span></span>
require_relative <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">config</span><span style="color:#710">'</span></span>

enable <span style="color:#A60">:sessions</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
        <span style="color:#080;font-weight:bold">if</span> session[<span style="color:#A60">:username</span>]
                <span style="color:#33B">@user</span> = <span style="color:#036;font-weight:bold">User</span>.find_by_username(session[<span style="color:#A60">:username</span>])
        <span style="color:#080;font-weight:bold">else</span> 
                <span style="color:#33B">@user</span> = <span style="color:#069">nil</span>
        <span style="color:#080;font-weight:bold">end</span>

        <span style="color:#33B">@posts</span> = <span style="color:#036;font-weight:bold">Post</span>.all

        erb <span style="color:#A60">:index</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
        redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  title = params[<span style="color:#A60">:title</span>]
  body = params[<span style="color:#A60">:body</span>]
  user = <span style="color:#036;font-weight:bold">User</span>.find_by_username(session[<span style="color:#A60">:username</span>])
  post = <span style="color:#036;font-weight:bold">Post</span>.new(<span style="color:#A60">:title</span> =&gt; title, <span style="color:#A60">:body</span> =&gt; body)
  user.posts &lt;&lt; post
  post.save
  redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts/:id/edit</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
        <span style="color:#33B">@post</span> = <span style="color:#036;font-weight:bold">Post</span>.find(params[<span style="color:#A60">:id</span>].to_i)
        <span style="color:#33B">@title</span> = <span style="color:#33B">@post</span>.title
  <span style="color:#33B">@body</span> = <span style="color:#33B">@post</span>.body
  erb <span style="color:#A60">:edit</span>

<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts/:id/edit</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
        title = params[<span style="color:#A60">:title</span>]
  body = params[<span style="color:#A60">:body</span>]
  user = <span style="color:#036;font-weight:bold">User</span>.find_by_username(session[<span style="color:#A60">:username</span>])
  post = <span style="color:#036;font-weight:bold">Post</span>.find(params[<span style="color:#A60">:id</span>])    <span style="color:#777">#(:title =&gt; title, :body =&gt; body)</span>
  post.title = title
        post.body = body
  user.posts &lt;&lt; post
  post.save
  redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
<span style="color:#777">####################</span>
get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts/:id/delete</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        id = params[<span style="color:#A60">:id</span>].to_i
        post = <span style="color:#036;font-weight:bold">Post</span>.find(id)
        post.destroy
        redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
<span style="color:#777">####################</span>
get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users/sign_up</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        erb <span style="color:#A60">:sign_up</span>
<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        user = <span style="color:#036;font-weight:bold">User</span>.create(<span style="color:#A60">:username</span> =&gt; params[<span style="color:#A60">:username</span>])
        session[<span style="color:#A60">:username</span>] = user.username
        redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users/sign_in</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        erb <span style="color:#A60">:sign_in</span>
<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users/sign_in</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
  <span style="color:#080;font-weight:bold">if</span> user = <span style="color:#036;font-weight:bold">User</span>.find_by_username(params[<span style="color:#A60">:username</span>])
          session[<span style="color:#A60">:username</span>] = user.username
          redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">else</span> 
          redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users/sign_up</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users/sign_out</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        session[<span style="color:#A60">:username</span>] = <span style="color:#069">nil</span>
        redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users/:id</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        <span style="color:#33B">@user</span> = <span style="color:#036;font-weight:bold">User</span>.find(params[<span style="color:#A60">:id</span>].to_i)
        erb <span style="color:#A60">:show</span>
<span style="color:#080;font-weight:bold">end</span>

post <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts/:id/comments</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        user = <span style="color:#036;font-weight:bold">User</span>.find_by_username(session[<span style="color:#A60">:username</span>])
        post = <span style="color:#036;font-weight:bold">Post</span>.find(params[<span style="color:#A60">:id</span>].to_i)
        comment = <span style="color:#036;font-weight:bold">Comment</span>.new(<span style="color:#A60">:body</span> =&gt; params[<span style="color:#A60">:comment_text</span>])
        comment.save 
        post.comments &lt;&lt; comment
        user.comments &lt;&lt; comment
        redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span> 

get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/posts/:id/like</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span> 
        binding.pry
        
        user = <span style="color:#036;font-weight:bold">User</span>.find_by_username(session[<span style="color:#A60">:username</span>])
        post = <span style="color:#036;font-weight:bold">Post</span>.find(params[<span style="color:#A60">:id</span>].to_i)

        <span style="color:#777"># like = Like.create</span>
        <span style="color:#777"># like.user = user</span>
        <span style="color:#777"># like.post = post</span>
        <span style="color:#777"># like.save</span>

        user.faves &lt;&lt; post

        redirect <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/</span><span style="color:#710">'</span></span>

<span style="color:#080;font-weight:bold">end</span>


</pre></div>
</div>

